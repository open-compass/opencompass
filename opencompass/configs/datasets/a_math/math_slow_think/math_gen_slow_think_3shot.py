from opencompass.openicl.icl_prompt_template import PromptTemplate
from opencompass.openicl.icl_retriever import ZeroRetriever
from opencompass.openicl.icl_inferencer import GenInferencer
from opencompass.datasets import MATHDataset, MATHEvaluator, math_postprocess_v2

math_reader_cfg = dict(input_columns=['problem'], output_column='solution')
stop_words = ["</s>", "<|im_end|>", "<|endoftext|>","<|end_of_text|>","\nught","\nughtuser","\nQuestion","\nnoteq","\nosterone","nosteroneuser"]
demo = []
demo.append("Okay, so I need to find the values of $a$ and $b$ that make this piecewise function continuous, and then add them together. Hmm, let me remember. For a piecewise function to be continuous, the left-hand limit and the right-hand limit at each boundary point must equal the function's value at that point. The function is defined in three parts: when $x > 2$, when $-2 \leq x \leq 2$, and when $x < -2$. So the critical points where the function could potentially be discontinuous are at $x = 2$ and $x = -2$. That makes sense because those are the points where the definition of the function changes.\n\nLet me start with $x = 2$. At $x = 2$, the function is defined by the middle piece, which is $f(x) = x - 5$. So first, I should check the limit as $x$ approaches $2$ from the left and from the right. Since the middle piece covers $-2 \leq x \leq 2$, approaching from the left would still be in the middle piece. Wait, actually, approaching $2$ from the left would still be in the middle piece, so the left-hand limit would just be $2 - 5 = -3$. Then approaching $2$ from the right, which is the part where $x > 2$, defined by $f(x) = ax + 3$. So the right-hand limit as $x$ approaches $2$ would be $a*(2) + 3 = 2a + 3$. For the function to be continuous at $x = 2$, these two limits must be equal to each other and also equal to $f(2)$. Since $f(2)$ is given by the middle piece, which is $-3$. Therefore, $2a + 3$ must equal $-3$.\n\nSo let me write that down:\n\nLeft-hand limit at $x = 2$: $\lim_{x \\to 2^{-}} f(x)=2 - 5 = -3$.\n\nRight-hand limit at $x = 2$: $\lim_{x \\to 2^{+}} f(x)=a*2 + 3 = 2a + 3$.\n\nSet them equal for continuity: $2a + 3 = -3$.\n\nSolving for $a$: subtract $3$ from both sides: $2a = -6$, then divide by $2$: $a = -3$. Okay, so $a$ is $-3$.\n\nNow, moving on to the other boundary point at $x = -2$. Let's check the continuity there. At $x = -2$, the function is defined by the middle piece: $f(x) = x - 5$. So $f(-2) = -2 -5 = -7$. Now, approaching $x = -2$ from the left ($x < -2$), the function is defined by the third piece: $f(x) = 2x - b$. So the left-hand limit as $x$ approaches $-2$ from the left would be $2*(-2) - b = -4 - b$. But wait, the left-hand limit at $x = -2$ would actually be the limit as $x$ approaches $-2$ from the left, which is $x < -2$, so using the third piece. Therefore, $\lim_{x \\to -2^{-}} f(x)=2*(-2) - b = -4 - b$.\n\nApproaching $x = -2$ from the right ($x > -2$), since $x$ is approaching from the right but still in the interval $-2 \leq x \leq 2$, so we use the middle piece: $f(x) = x - 5$. Therefore, the right-hand limit is $\lim_{x \\to -2^{+}} f(x)=(-2) -5 = -7$.\n\nFor continuity at $x = -2$, the left-hand limit ($-4 - b$) must equal the right-hand limit ($-7$) and also equal $f(-2) = -7$. So setting left-hand limit equal to $f(-2)$:\n\n$-4 - b = -7$.\n\nSolving for $b$: add $4$ to both sides: $-b = -3$, then multiply by $-1$: $b = 3$. Okay, so $b$ is $3$.\n\nTherefore, $a = -3$ and $b = 3$. Hence, $a + b = -3 + 3 = 0$. Let me just verify once again to make sure I didn't make any mistakes.\n\nAt $x = 2$:\n\nLeft-hand limit: $2 -5 = -3$.\n\nRight-hand limit: $a*2 +3 = (-3)*2 +3 = -6 +3 = -3$. So that's equal, good.\n\nFunction value at $x = 2$ is $-3$. So all three are equal. Good.\n\nAt $x = -2$:\n\nLeft-hand limit: $2*(-2) -b = -4 -3 = -7$.\n\nRight-hand limit: $-2 -5 = -7$.\n\nFunction value at $x = -2$ is $-7$. All three equal. Perfect.\n\nSo yes, $a = -3$ and $b = 3$. Therefore, $a + b = 0$.\n\nSo the answer is $\\boxed{0}$.")

demo.append("Okay, so I need to find the other root of the quadratic equation $5x^{2}+kx = 4$ given that one of the roots is 2. Hmm, let me think about how to approach this.\n\nFirst, I remember that for a quadratic equation $ax^{2}+bx + c = 0$, the sum of the roots is $-b/a$ and the product of the roots is $c/a$. Maybe I can use Vieta's formulas here? But wait, the given equation isn't in the standard form. Let me rewrite it.\n\nStarting with the original equation: $5x^{2}+kx = 4$. To convert it to the standard form, I need to subtract 4 from both sides. That gives:\n\n$5x^{2}+kx - 4 = 0$\n\nNow, it's in the form $ax^{2}+bx + c = 0$ where $a = 5$, $b = k$, and $c = -4$.\n\nGiven that one root is 2, let's denote the roots as $r_{1}=2$ and $r_{2}=?$. According to Vieta's formulas:\n\nSum of roots: $r_{1}+r_{2}=-b/a=-k/5$\n\nProduct of roots: $r_{1}\\times r_{2}=c/a=-4/5$\n\nSince I know one root is 2, I can plug that into the product formula first. Let's see:\n\n$2\\times r_{2}=-4/5$\n\nSolving for $r_{2}$:\n\n$r_{2}=(-4/5)/2=(-4/5)\\times(1/2)=-2/5$\n\nSo, the other root should be $-2/5$. Let me check if that makes sense with the sum of roots.\n\nSum of roots: $2+(-2/5)=10/5 - 2/5=8/5$\n\nAccording to Vieta, this sum should equal $-k/5$. So:\n\n$8/5=-k/5$\n\nMultiplying both sides by 5:\n\n$8=-k$\n\nTherefore, $k = -8$. Let me verify if this value of k satisfies the original equation when x = 2.\n\nOriginal equation: $5x^{2}+kx = 4$. Plugging in x = 2 and k=-8:\n\nLeft side: $5\\times(2)^{2}+(-8)\\times(2)=5\\times4 - 16=20 - 16=4$\n\nRight side: 4. So it checks out.\n\nAlternatively, maybe I can plug k=-8 into the equation and solve for the roots. Let's try that.\n\nEquation becomes: $5x^{2}-8x - 4 = 0$\n\nUsing quadratic formula: $x=[8\pm\sqrt{(-8)^{2}-4\\times5\\times(-4)}]/(2\\times5)$\n\nCalculating discriminant:\n\n$64-4\\times5\\times(-4)=64 + 80=144$\n\nSo, $\sqrt{144}=12$\n\nThus, $x = [8\pm12]/10$\n\nFirst root: $(8 + 12)/10=20/10 = 2$, which matches the given root.\n\nSecond root: $(8 - 12)/10=(-4)/10=-2/5$, which is what I found earlier.\n\nSo both methods confirm that the other root is -2/5. Therefore, the answer should be -2/5.\n\nBut let me just recap the steps to make sure I didn't skip anything. Given that 2 is a root, substitution into the equation allows us to solve for k. Then, using Vieta's formula or factoring/quadratic formula gives the other root. Both approaches lead to the same result, which gives me confidence.\n\nAlternatively, if I didn't remember Vieta's formulas, I could substitute x = 2 into the equation and solve for k first, then find the other root. Let me try that approach as another check.\n\nOriginal equation: $5x^{2}+kx = 4$. If x = 2 is a root, then substituting x = 2:\n\n$5\\times(2)^2 + k\\times2 = 4$\n\n$5\\times4 + 2k = 4$\n\n$20 + 2k = 4$\n\nSubtract 20: $2k = -16$\n\nDivide by 2: $k = -8$\n\nSo, k is -8, same as before. Then the equation is $5x^2 - 8x - 4 = 0$, which can be solved as above. So this method also works.\n\nHence, all methods converge to the other root being -2/5. Therefore, I think that's the correct answer.\n\nSo the answer is $\\boxed{-\\frac{2}{5}}$.")

demo.append("Okay, so I need to figure out for which values of $b$ the number $-2$ is not in the range of the function $f(x) = x^2 + bx + 2$. Hmm, let\'s start by recalling that the range of a quadratic function depends on whether it opens upwards or downwards and the value of its vertex. Since the coefficient of $x^2$ here is 1, which is positive, the parabola opens upwards. That means the function has a minimum value at its vertex and the range is from that minimum value to infinity.\n\nSo, if $-2$ is not in the range, that means the minimum value of the function must be greater than $-2$. Therefore, I need to find the vertex of the parabola and set its y-coordinate to be greater than $-2$. The vertex of a parabola $f(x) = ax^2 + bx + c$ is at $x = \\frac{-b}{2a}$. In this case, $a = 1$, so the x-coordinate of the vertex is $x = \\frac{-b}{2}$.\n\nLet me calculate the y-coordinate of the vertex by plugging this x-value back into the function:\n$$ f\\left( \\frac{-b}{2} \\right) = \\left( \\frac{-b}{2} \\right)^2 + b \\left( \\frac{-b}{2} \\right) + 2 $$\n\nSimplifying that:\n\nFirst, square $\\frac{-b}{2}$:\n$$ \\left( \\frac{-b}{2} \\right)^2 = \\frac{b^2}{4} $$\n\nNext, multiply $b$ by $\\frac{-b}{2}$:\n$$ b \\\times \\frac{-b}{2} = \\frac{-b^2}{2} $$\n\nSo, putting it all together:\n$$ \\frac{b^2}{4} + \\frac{-b^2}{2} + 2 $$\n\nCombine the $b^2$ terms:\n$$ \\frac{b^2}{4} - \\frac{2b^2}{4} = \\frac{-b^2}{4} $$\n\nTherefore, the y-coordinate of the vertex is:\n$$ \\frac{-b^2}{4} + 2 $$\n\nSo the minimum value of the function is:\n$$ 2 - \\frac{b^2}{4} $$\n\nWe want this minimum value to be greater than $-2$:\n$$ 2 - \\frac{b^2}{4} > -2 $$\n\nLet\'s solve this inequality:\n\nSubtract 2 from both sides:\n$$ -\\frac{b^2}{4} > -4 $$\n\nMultiply both sides by -4, remembering that multiplying by a negative number reverses the inequality:\n$$ b^2 < 16 $$\n\nSo, $b^2 < 16$ implies that $|b| < 4$, which does translate to $-4 < b < 4$. Therefore, the values of $b$ for which $-2$ is not in the range of $f(x)$ are those between $-4$ and $4$.\n\nBut wait, let me verify this. If $b^2 < 16$, then $|b| < 4$, which does translate to $-4 < b < 4$. So in interval notation, that\'s $(-4, 4)$.\n\nBut just to make sure I didn\'t make a mistake in the steps, let me check with a specific example. Let\'s take $b = 0$. Then the function becomes $f(x) = x^2 + 2$. The minimum value is at $x = 0$, which is 2. So the range is $[2, \infty)$, which indeed doesn\'t include -2. That\'s consistent with our result.\n\nAnother test case: if $b = 4$, then the vertex is at $x = \\frac{-4}{2} = -2$. Plugging back in,\n$$ f(-2) = (-2)^2 + 4 \\\times (-2) + 2 = 4 - 8 + 2 = -2 $$\n\nSo when $b = 4$, the minimum value is exactly -2, which means -2 is in the range. Therefore, $b = 4$ is excluded, which matches our interval $(-4, 4)$. Similarly, if $b = -4$, the vertex is at $x = \\frac{-(-4)}{2} = 2$. Then,\n$$ f(2) = 4 + (-4)(2) + 2 = 4 - 8 + 2 = -2 $$\n\nSo again, -2 is in the range when $b = -4$, so those endpoints are excluded.\n\nTherefore, the correct interval for $b$ where -2 is not in the range is $(-4, 4)$.\n\nSo the answer is $\\boxed{(-4, 4)}$.")

prompt = (
    f"Consider the following three reasoning process examples:\n" 
    + "Example 1 \n" + demo[0] + '\n'
    + "Example 2 \n" + demo[1] + '\n'
    + "Example 3 \n" + demo[2] + "\n\n"
    "Please refer to the reasoning approaches demonstrated above, solve the following question by yourself:\n"
    "{problem}\n\n"
    "Finally, provide your answer in the following format: 'So the answer is $\\boxed{}$'."
)


math_infer_cfg = dict(
    prompt_template=dict(
        type=PromptTemplate,
        template=dict(
            round=[
                dict(role='HUMAN', prompt=prompt),
            ]
        ),
    ),
    retriever=dict(type=ZeroRetriever),
    inferencer=dict(type=GenInferencer, max_out_len=4096,stopping_criteria=stop_words),
)

# postprocess v2
math_eval_cfg = dict(
    evaluator=dict(type=MATHEvaluator, version='v2'), pred_postprocessor=dict(type=math_postprocess_v2),
)

math_datasets = [
    dict(
        type=MATHDataset,
        abbr='math_slow_think_3shot',
        path='opencompass/math',
        reader_cfg=math_reader_cfg,
        infer_cfg=math_infer_cfg,
        eval_cfg=math_eval_cfg,
    )
]
