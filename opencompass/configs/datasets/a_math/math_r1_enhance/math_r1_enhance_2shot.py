from opencompass.openicl.icl_prompt_template import PromptTemplate
from opencompass.openicl.icl_retriever import ZeroRetriever
from opencompass.openicl.icl_inferencer import GenInferencer
from opencompass.datasets import MATHDataset, MATHEvaluator, math_postprocess_v2

math_reader_cfg = dict(input_columns=['problem'], output_column='solution')
stop_words = ["</s>", "<|im_end|>", "<|endoftext|>","<|end_of_text|>","\nught","\nughtuser","\nQuestion","\nnoteq","\nosterone","nosteroneuser"]

round = [
{'role': 'HUMAN', 'prompt': "Problem: Let \\[f(x) = \\left\\{\n\\begin{array}{cl} ax+3, &\\text{ if }x>2, \\\\\nx-5 &\\text{ if } -2 \\le x \\le 2, \\\\\n2x-b &\\text{ if } x <-2.\n\\end{array}\n\\right.\\]Find $a+b$ if the piecewise function is continuous (which means that its graph can be drawn without lifting your pencil from the paper).\nPlease reason step by step, and put your final answer within \\boxed{}.\nSolution:"},
{'role': 'BOT', 'prompt': "Okay, so I need to find the values of $a$ and $b$ that make this piecewise function continuous, and then add them together. Hmm, let me remember. For a piecewise function to be continuous, the left-hand limit and the right-hand limit at each boundary point must equal the function's value at that point. The function is defined in three parts: when $x > 2$, when $-2 \leq x \leq 2$, and when $x < -2$. So the critical points where the function could potentially be discontinuous are at $x = 2$ and $x = -2$. That makes sense because those are the points where the definition of the function changes.\n\nLet me start with $x = 2$. At $x = 2$, the function is defined by the middle piece, which is $f(x) = x - 5$. So first, I should check the limit as $x$ approaches $2$ from the left and from the right. Since the middle piece covers $-2 \leq x \leq 2$, approaching from the left would still be in the middle piece. Wait, actually, approaching $2$ from the left would still be in the middle piece, so the left-hand limit would just be $2 - 5 = -3$. Then approaching $2$ from the right, which is the part where $x > 2$, defined by $f(x) = ax + 3$. So the right-hand limit as $x$ approaches $2$ would be $a*(2) + 3 = 2a + 3$. For the function to be continuous at $x = 2$, these two limits must be equal to each other and also equal to $f(2)$. Since $f(2)$ is given by the middle piece, which is $-3$. Therefore, $2a + 3$ must equal $-3$.\n\nSo let me write that down:\n\nLeft-hand limit at $x = 2$: $\lim_{x \to 2^{-}} f(x)=2 - 5 = -3$.\n\nRight-hand limit at $x = 2$: $\lim_{x \to 2^{+}} f(x)=a*2 + 3 = 2a + 3$.\n\nSet them equal for continuity: $2a + 3 = -3$.\n\nSolving for $a$: subtract $3$ from both sides: $2a = -6$, then divide by $2$: $a = -3$. Okay, so $a$ is $-3$.\n\nNow, moving on to the other boundary point at $x = -2$. Let's check the continuity there. At $x = -2$, the function is defined by the middle piece: $f(x) = x - 5$. So $f(-2) = -2 -5 = -7$. Now, approaching $x = -2$ from the left ($x < -2$), the function is defined by the third piece: $f(x) = 2x - b$. So the left-hand limit as $x$ approaches $-2$ from the left would be $2*(-2) - b = -4 - b$. But wait, the left-hand limit at $x = -2$ would actually be the limit as $x$ approaches $-2$ from the left, which is $x < -2$, so using the third piece. Therefore, $\lim_{x \to -2^{-}} f(x)=2*(-2) - b = -4 - b$.\n\nApproaching $x = -2$ from the right ($x > -2$), since $x$ is approaching from the right but still in the interval $-2 \leq x \leq 2$, so we use the middle piece: $f(x) = x - 5$. Therefore, the right-hand limit is $\lim_{x \to -2^{+}} f(x)=(-2) -5 = -7$.\n\nFor continuity at $x = -2$, the left-hand limit ($-4 - b$) must equal the right-hand limit ($-7$) and also equal $f(-2) = -7$. So setting left-hand limit equal to $f(-2)$:\n\n$-4 - b = -7$.\n\nSolving for $b$: add $4$ to both sides: $-b = -3$, then multiply by $-1$: $b = 3$. Okay, so $b$ is $3$.\n\nTherefore, $a = -3$ and $b = 3$. Hence, $a + b = -3 + 3 = 0$. Let me just verify once again to make sure I didn't make any mistakes.\n\nAt $x = 2$:\n\nLeft-hand limit: $2 -5 = -3$.\n\nRight-hand limit: $a*2 +3 = (-3)*2 +3 = -6 +3 = -3$. So that's equal, good.\n\nFunction value at $x = 2$ is $-3$. So all three are equal. Good.\n\nAt $x = -2$:\n\nLeft-hand limit: $2*(-2) -b = -4 -3 = -7$.\n\nRight-hand limit: $-2 -5 = -7$.\n\nFunction value at $x = -2$ is $-7$. All three equal. Perfect.\n\nSo yes, $a = -3$ and $b = 3$. Therefore, $a + b = 0$."},
{'role': 'HUMAN', 'prompt': "Problem: The perimeter of a rectangle is 24 inches. What is the number of square inches in the maximum possible area for this rectangle?\nPlease reason step by step, and put your final answer within \\boxed{}.\nSolution:"},
{'role': 'BOT', 'prompt': "Okay, so I need to find the maximum possible area of a rectangle with a perimeter of 24 inches. Hmm, let's see. I remember that for a rectangle, the perimeter is calculated by the formula $P = 2*(length + width)$. In this case, the perimeter is 24 inches, so I can set up the equation: $24 = 2*(l + w)$. To simplify, divide both sides by 2, which gives me $12 = l + w$. So the sum of the length and width is 12 inches.\n\nNow, the area of a rectangle is $A = l * w$. My goal is to maximize this area given the constraint that $l + w = 12$. Hmm, how do I approach this? I think this is an optimization problem where I have to find the maximum value of the area function under a certain condition. Maybe I can express one variable in terms of the other using the perimeter equation and substitute it into the area formula. Let me try that.\n\nFrom the perimeter equation: $l + w = 12$, so let's solve for $w$: $w = 12 - l$. Then substitute this into the area formula: $A = l * (12 - l) = 12l - l²$. So the area is a quadratic function of $l$: $A(l) = -l² + 12l$.\n\nQuadratic functions have their maximum or minimum at the vertex. Since the coefficient of $l²$ is negative ($-1$), the parabola opens downward, which means the vertex is the maximum point. The vertex of a parabola given by $A(l) = al² + bl + c$ is at $l = -b/(2a)$. In this case, $a = -1$ and $b = 12$, so $l = -12/(2*(-1)) = -12/-2 = 6$. So the length that gives the maximum area is 6 inches.\n\nThen, substituting back into the equation for $w$: $w = 12 - l = 12 - 6 = 6$ inches. Wait, so both length and width are 6 inches? That means the rectangle is actually a square. Is that always the case? I remember hearing somewhere that for a given perimeter, the shape with the maximum area is a square. So that makes sense here.\n\nLet me double-check my math to be sure. The perimeter of a square with sides 6 inches would be $4*6 = 24$ inches, which matches the given perimeter. The area would be $6*6 = 36$ square inches. If I try a different rectangle, say with length 5 and width 7 (since $5 + 7 = 12$), the area would be $5*7 = 35$, which is less than 36. Similarly, if I take length 4 and width 8, the area is $4*8 = 32$, which is even smaller. So it does seem like 36 is the maximum area.\n\nAlternatively, maybe I can use calculus to confirm. Taking the area function $A(l) = -l² + 12l$, the derivative with respect to $l$ is $A’(l) = -2l + 12$. Setting the derivative equal to zero for critical points: $-2l + 12 = 0 \Rightarrow -2l = -12 \Rightarrow l = 6$. Then, the second derivative is $A''(l) = -2$, which is negative, confirming that the critical point at $l = 6$ is indeed a maximum. So calculus also gives me the same result.\n\nTherefore, the maximum area is when the rectangle is a square with sides 6 inches, and the area is 36 square inches. Let me just check one more example to make sure. If the length is 6.5 inches, then the width would be $12 - 6.5 = 5.5$ inches. The area would be $6.5*5.5 = 35.75$, which is still less than 36. Similarly, if the length is 5.5, width is 6.5, area is the same 35.75. Yep, so 36 is indeed the maximum.\n\nAnother way to think about it is that the square is the most efficient in terms of area for a given perimeter among all rectangles. So if the problem allows for the rectangle to be a square, then that's when you get the maximum area. If there were constraints that it can't be a square, then the maximum would be different, but since there are no such constraints here, the answer must be 36.\n\nAlright, so after verifying through different methods—algebraic using vertex formula, checking specific cases, calculus, and logical reasoning—it seems clear that the maximum area is 36 square inches.\n\n**Final Answer**\n\nThe maximum possible area for the rectangle is \boxed{36} square inches."},
{'role': 'HUMAN', 'prompt': "Problem:\n{problem}\nPlease reason step by step, and put your final answer within \\boxed{}.\nSolution:"},
]

math_infer_cfg = dict(
    prompt_template=dict(
        type=PromptTemplate,
        template=dict(round=round)),
    retriever=dict(type=ZeroRetriever),
    inferencer=dict(type=GenInferencer, max_out_len=4096, stopping_criteria=stop_words))

# postprocess v2
math_eval_cfg = dict(
    evaluator=dict(type=MATHEvaluator, version='v2'), pred_postprocessor=dict(type=math_postprocess_v2),
)

math_datasets = [
    dict(
        type=MATHDataset,
        abbr='math_r1_enhance_2shot',
        path='opencompass/math',
        reader_cfg=math_reader_cfg,
        infer_cfg=math_infer_cfg,
        eval_cfg=math_eval_cfg,
    )
]
