from opencompass.openicl.icl_prompt_template import PromptTemplate
from opencompass.openicl.icl_retriever import ZeroRetriever
from opencompass.openicl.icl_inferencer import GenInferencer
from opencompass.datasets import MATHDataset, MATHEvaluator, math_postprocess_v2

math_reader_cfg = dict(input_columns=['problem'], output_column='solution')
stop_words = ["</s>", "<|im_end|>", "<|endoftext|>","<|end_of_text|>","\nught","\nughtuser","\nQuestion","\nnoteq","\nosterone","nosteroneuser"]

round = [
{'role': 'HUMAN', 'prompt': "Problem: If $\\mathbf{a},$ $\\mathbf{b},$ and $\\mathbf{c}$ are unit vectors, then find the largest possible value of\n\\[\\|\\mathbf{a} - \\mathbf{b}\\|^2 + \\|\\mathbf{a} - \\mathbf{c}\\|^2 + \\|\\mathbf{b} - \\mathbf{c}\\|^2.\\]Note: A unit vector is a vector of magnitude 1.\nPlease reason step by step, and put your final answer within \\boxed{}.\nSolution:"},
{'role': 'BOT', 'prompt': "To solve this problem, we need to maximize the expression:\n\\[\n\\|\\mathbf{a} - \\mathbf{b}\\|^2 + \\|\\mathbf{a} - \\mathbf{c}\\|^2 + \\|\\mathbf{b} - \\mathbf{c}\\|^2,\n\\]\nwhere $\\mathbf{a}, \\mathbf{b}, \\mathbf{c}$ are unit vectors ($\\|\\mathbf{a}\\| = \\|\\mathbf{b}\\| = \\|\\mathbf{c}\\| = 1$). Let us break it down step by step.\n\n---\n\n### Step 1: Expand each squared norm\nFor any two vectors $\\mathbf{u}$ and $\\mathbf{v}$, the squared distance between them is given by:\n\\[\n\\|\\mathbf{u} - \\mathbf{v}\\|^2 = \\|\\mathbf{u}\\|^2 + \\|\\mathbf{v}\\|^2 - 2(\\mathbf{u} \\cdot \\mathbf{v}).\n\\]\nSince $\\|\\mathbf{a}\\| = \\|\\mathbf{b}\\| = \\|\\mathbf{c}\\| = 1$, this simplifies to:\n\\[\n\\|\\mathbf{a} - \\mathbf{b}\\|^2 = 2 - 2(\\mathbf{a} \\cdot \\mathbf{b}),\n\\]\n\\[\n\\|\\mathbf{a} - \\mathbf{c}\\|^2 = 2 - 2(\\mathbf{a} \\cdot \\mathbf{c}),\n\\]\n\\[\n\\|\\mathbf{b} - \\mathbf{c}\\|^2 = 2 - 2(\\mathbf{b} \\cdot \\mathbf{c}).\n\\]\nAdding these together gives:\n\\[\n\\|\\mathbf{a} - \\mathbf{b}\\|^2 + \\|\\mathbf{a} - \\mathbf{c}\\|^2 + \\|\\mathbf{b} - \\mathbf{c}\\|^2 = 6 - 2(\\mathbf{a} \\cdot \\mathbf{b} + \\mathbf{a} \\cdot \\mathbf{c} + \\mathbf{b} \\cdot \\mathbf{c}).\n\\]\n---\n\n### Step 2: Maximize the expression\nTo maximize the above expression, we minimize the sum $\\mathbf{a} \\cdot \\mathbf{b} + \\mathbf{a} \\cdot \\mathbf{c} + \\mathbf{b} \\cdot \\mathbf{c}$. The dot product between two unit vectors ranges from $-1$ to $1$. The minimum occurs when all three vectors are mutually orthogonal (dot products are zero):\n\\[\n\\mathbf{a} \\cdot \\mathbf{b} = \\mathbf{a} \\cdot \\mathbf{c} = \\mathbf{b} \\cdot \\mathbf{c} = -\\frac{1}{2}.\n\\]\nSubstituting this into the expression:\n\\[\n6 - 2(-\\frac{3}{2}) = 9.\n\\]\n---\n\n### Final Answer:\nThe largest possible value is:\n\\[\n\\boxed{9}\n\\]"},
{'role': 'HUMAN', 'prompt': "Problem: What is the largest five-digit integer whose digits have a product equal to the product $(7)(6)(5)(4)(3)(2)(1)$?\nPlease reason step by step, and put your final answer within \\boxed{}.\nSolution:"},
{'role': 'BOT', 'prompt': "To solve this problem, we need to determine the largest five-digit integer whose digits have a product equal to $ 7 \\times 6 \\times 5 \\times 4 \\times 3 \\times 2 \\times 1 $. Let's break it down step by step.\n\n---\n\n### Step 1: Compute the total product\nThe given product is:\n\\[\n7 \\times 6 \\times 5 \\times 4 \\times 3 \\times 2 \\times 1 = 7!.\n\\]\nCompute $ 7! $:\n\\[\n7! = 7 \\times 6 \\times 5 \\times 4 \\times 3 \\times 2 \\times 1 = 5040.\n\\]\nThus, the product of the digits of the desired five-digit number must also equal $ 5040 $.\n\n---\n\n### Step 2: Strategy to maximize the number\nTo form the largest possible five-digit integer, we want the digits to be as large as possible, arranged in descending order. Each digit must be between $ 1 $ and $ 9 $ because $ 0 $ would make the product $ 0 $, which is invalid.\n\nAdditionally, since the product of all five digits must equal $ 5040 $, we will factorize $ 5040 $ into exactly five factors (digits), prioritizing larger digits first.\n\n---\n\n### Step 3: Factorize $ 5040 $ into five digits\nStart with the prime factorization of $ 5040 $:\n\\[\n5040 = 2^4 \\times 3^2 \\times 5 \\times 7.\n\\]\nWe now group these prime factors into five integers (digits) such that their product equals $ 5040 $ and the digits are as large as possible.\n\n#### First attempt:\n- Start with the largest single-digit factor, $ 9 $ ($ 9 = 3^2 $).\n- After using $ 9 $, the remaining product is:\n\\[\n\\frac{5040}{9} = 560.\n\\]\n\n- Next, use the largest single-digit factor of $ 560 $, which is $ 8 $ ($ 8 = 2^3 $).\n- After using $ 8 $, the remaining product is:\n\\[\n\\frac{560}{8} = 70.\n\\]\n\n- Next, use the largest single-digit factor of $ 70 $, which is $ 7 $ ($ 7 = 7 $).\n- After using $ 7 $, the remaining product is:\n\\[\n\\frac{70}{7} = 10.\n\\]\n\n- Finally, split $ 10 $ into two single-digit factors: $ 5 $ and $ 2 $.\n\nThus, the five digits are $ 9, 8, 7, 5, 2 $.\n\n---\n\n### Step 4: Arrange the digits in descending order\nTo maximize the number, arrange the digits $ 9, 8, 7, 5, 2 $ in descending order:\n\\[\n98752.\n\\]\n\n---\n\n### Step 5: Verify the solution\nCheck that the product of the digits equals $ 5040 $:\n\\[\n9 \\times 8 \\times 7 \\times 5 \\times 2 = 5040.\n\\]\nThis confirms that the solution is correct.\n\n---\n\n### Final Answer:\n\\[\n\\boxed{98752}\n\\]"},
{'role': 'HUMAN', 'prompt': "Problem: The number 236! ends in how many zeros when expressed as an integer?\nPlease reason step by step, and put your final answer within \\boxed{}.\nSolution:"},
{'role': 'BOT', 'prompt': "To solve this problem, we need to determine how many trailing zeros $ 236! $ has when expressed as an integer. Trailing zeros are created by factors of $ 10 $, which are the product of $ 2 $ and $ 5 $. Since there are always more factors of $ 2 $ than $ 5 $ in factorials, we count the number of factors of $ 5 $ in $ 236! $. Let's break it down step by step.\n\n---\n\n### Step 1: Count the factors of $ 5 $\nThe number of factors of $ 5 $ in $ 236! $ is given by:\n\\[\n\\text{Number of factors of } 5 = \\left\\lfloor \\frac{236}{5} \\right\\rfloor + \\left\\lfloor \\frac{236}{25} \\right\\rfloor + \\left\\lfloor \\frac{236}{125} \\right\\rfloor.\n\\]\nCompute each term:\n\\[\n\\left\\lfloor \\frac{236}{5} \\right\\rfloor = 47, \\quad \\left\\lfloor \\frac{236}{25} \\right\\rfloor = 9, \\quad \\left\\lfloor \\frac{236}{125} \\right\\rfloor = 1.\n\\]\nAdd them up:\n\\[\n47 + 9 + 1 = 57.\n\\]\nThus, there are $ 57 $ factors of $ 5 $ in $ 236! $.\n\n---\n\n### Step 2: Conclusion\nSince each factor of $ 5 $ pairs with a factor of $ 2 $ to create a factor of $ 10 $, the number of trailing zeros in $ 236! $ is equal to the number of factors of $ 5 $. Therefore, $ 236! $ ends in $ 57 $ zeros.\n\n---\n\n### Final Answer:\n\\[\n\\boxed{57}\n\\]"},
{'role': 'HUMAN', 'prompt': "Problem: Find the positive solution to\n\\[\\sqrt[3]{x + \\sqrt[3]{x + \\sqrt[3]{x + \\dotsb}}} = \\sqrt[3]{x \\sqrt[3]{x \\sqrt[3]{x \\dotsm}}}.\\]\nPlease reason step by step, and put your final answer within \\boxed{}.\nSolution:"},
{'role': 'BOT', 'prompt': "To solve this problem, we need to find the positive solution to the equation:\n\\[\n\\sqrt[3]{x + \\sqrt[3]{x + \\sqrt[3]{x + \\dotsb}}} = \\sqrt[3]{x \\sqrt[3]{x \\sqrt[3]{x \\dotsm}}}.\n\\]\nLet us break it down step by step.\n\n---\n\n### Step 1: Define the left-hand side\nLet:\n\\[\ny = \\sqrt[3]{x + \\sqrt[3]{x + \\sqrt[3]{x + \\dotsb}}}.\n\\]\nCubing both sides gives:\n\\[\ny^3 = x + y.\n\\]\nRearranging:\n\\[\nx = y^3 - y. \\tag{1}\n\\]\n\n---\n\n### Step 2: Define the right-hand side\nLet:\n\\[\nz = \\sqrt[3]{x \\sqrt[3]{x \\sqrt[3]{x \\dotsm}}}.\n\\]\nCubing both sides gives:\n\\[\nz^3 = x z.\n\\]\nIf $ z \\neq 0 $, divide through by $ z $:\n\\[\nz^2 = x. \\tag{2}\n\\]\n\n---\n\n### Step 3: Equate the two expressions for $ x $\nFrom equations (1) and (2), we have:\n\\[\ny^3 - y = z^2.\n\\]\nSubstitute $ z^2 = x $ from equation (2) into equation (1):\n\\[\ny^3 - y = y^2.\n\\]\nRearrange:\n\\[\ny^3 - y^2 - y = 0.\n\\]\nFactorize:\n\\[\ny(y^2 - y - 1) = 0.\n\\]\nSince $ y > 0 $, solve $ y^2 - y - 1 = 0 $ using the quadratic formula:\n\\[\ny = \\frac{1 \\pm \\sqrt{5}}{2}.\n\\]\nTake the positive root:\n\\[\ny = \\frac{1 + \\sqrt{5}}{2}.\n\\]\n\n---\n\n### Step 4: Solve for $ x $\nSubstitute $ y = \\frac{1 + \\sqrt{5}}{2} $ into $ x = y^2 $:\n\\[\nx = y^2 = \\left(\\frac{1 + \\sqrt{5}}{2}\\right)^2 = \\frac{1 + 2\\sqrt{5} + 5}{4} = \\frac{6 + 2\\sqrt{5}}{4} = \\frac{3 + \\sqrt{5}}{2}.\n\\]\n\n---\n\n### Final Answer:\nThe positive solution is:\n\\[\n\\boxed{\\frac{3 + \\sqrt{5}}{2}}\n\\]"},
{'role': 'HUMAN', 'prompt': "Problem: The graph of the quadratic $y = ax^2 + bx + c$ has the following properties: (1) The maximum value of $y = ax^2 + bx + c$ is 5, which occurs at $x = 3$. (2) The graph passes through the point $(0,-13)$. If the graph passes through the point $(4,m)$, then what is the value of $m$?\nPlease reason step by step, and put your final answer within \\boxed{}.\nSolution:"},
{'role': 'BOT', 'prompt': "To solve this problem, we need to determine the value of $ m $ for the quadratic function $ y = ax^2 + bx + c $ given the properties:\n1. The maximum value of $ y $ is $ 5 $, occurring at $ x = 3 $.\n2. The graph passes through $ (0, -13) $.\n3. The graph passes through $ (4, m) $.\nLet us break it down step by step.\n\n---\n\n### Step 1: Use the vertex property\nSince the maximum value of $ y $ is $ 5 $ at $ x = 3 $, the vertex form of the quadratic equation is:\n\\[\ny = a(x - 3)^2 + 5.\n\\]\n\n---\n\n### Step 2: Use the point $ (0, -13) $\nThe graph passes through $ (0, -13) $, so substitute $ x = 0 $ and $ y = -13 $ into the equation:\n\\[\n-13 = a(0 - 3)^2 + 5.\n\\]\nSimplify:\n\\[\n-13 = 9a + 5.\n\\]\nSolve for $ a $:\n\\[\n9a = -18 \\implies a = -2.\n\\]\nThus, the quadratic equation becomes:\n\\[\ny = -2(x - 3)^2 + 5.\n\\]\n\n---\n\n### Step 3: Use the point $ (4, m) $\nThe graph passes through $ (4, m) $, so substitute $ x = 4 $ into the equation:\n\\[\nm = -2(4 - 3)^2 + 5.\n\\]\nSimplify:\n\\[\nm = -2(1)^2 + 5 = -2 + 5 = 3.\n\\]\n\n---\n\n### Final Answer:\nThe value of $ m $ is:\n\\[\n\\boxed{3}\n\\]"},
{'role': 'HUMAN', 'prompt': "Problem: How many integers $n$ satisfy the condition $100 < n < 200$ and the condition $n$ has the same remainder whether it is divided by $6$ or by $8$?\nPlease reason step by step, and put your final answer within \\boxed{}.\nSolution:"},
{'role': 'BOT', 'prompt': "To solve this problem, we need to determine how many integers $ n $ satisfy $ 100 < n < 200 $ and leave the same remainder when divided by $ 6 $ or $ 8 $. Let us break it down step by step.\n\n---\n\n### Step 1: Represent $ n $ mathematically\nIf $ n $ leaves the same remainder $ r $ when divided by $ 6 $ and $ 8 $, then:\n\\[\nn = 6a + r = 8b + r,\n\\]\nwhere $ 0 \\leq r \\leq 5 $. Subtract $ r $ from both sides:\n\\[\n6a = 8b.\n\\]\nSimplify:\n\\[\n3a = 4b.\n\\]\nThis implies $ a $ is a multiple of $ 4 $, so let $ a = 4k $. Substituting $ a = 4k $ into $ n = 6a + r $:\n\\[\nn = 24k + r.\n\\]\n\n---\n\n### Step 2: Solve for $ k $\nSince $ 100 < n < 200 $, solve:\n\\[\n100 < 24k + r < 200.\n\\]\nFor each $ k $, $ r $ can take values $ 0, 1, 2, 3, 4, 5 $. Solve for $ k $:\n\\[\n100 < 24k < 200.\n\\]\nDivide through by $ 24 $:\n\\[\n4.1667 < k < 8.3333.\n\\]\nThus, $ k = 5, 6, 7, 8 $.\n\n---\n\n### Step 3: Count valid cases\n- For $ k = 5 $, $ r = 5 $ is required to keep $ n > 100 $.\n- For $ k = 6, 7, 8 $, $ r = 0, 1, 2, 3, 4, 5 $ are all valid.\nTotal cases:\n\\[\n1 + 6 + 6 + 6 = 25.\n\\]\n\n---\n\n### Final Answer:\nThe total number of integers $ n $ is:\n\\[\n\\boxed{25}\n\\]"},
{'role': 'HUMAN', 'prompt': "Problem: Two congruent right circular cones each with base radius $3$ and height $8$ have the axes of symmetry that intersect at right angles at a point in the interior of the cones a distance $3$ from the base of each cone. A sphere with radius $r$ lies withing both cones. The maximum possible value of $r^2$ is $\\frac{m}{n}$, where $m$ and $n$ are relatively prime positive integers. Find $m+n$.\n\nPlease reason step by step, and put your final answer within \\boxed{}.\nSolution:"},
{'role': 'BOT', 'prompt': "To solve this problem, we need to determine the maximum possible value of $ r^2 $ for a sphere that lies within two congruent cones whose axes intersect at right angles. Let us break it down step by step.\n\n---\n\n### Step 1: Geometry of the cones\nEach cone has a base radius $ 3 $ and height $ 8 $. The axis of symmetry of one cone is along the $ z $-axis, and the other is along the $ y $-axis. The axes intersect at a point $ (0, 3, 3) $, which is $ 3 $ units from the base of each cone.\n\nThe sphere is tangent to the sides of both cones, and its center lies on the line of intersection of the two cones' symmetry planes.\n\n---\n\n### Step 2: Maximum radius of the sphere\nUsing geometric reasoning, the maximum radius $ r $ of the sphere satisfies:\n\\[\nr = \\frac{15}{\\sqrt{73}}.\n\\]\nThus:\n\\[\nr^2 = \\frac{225}{73}.\n\\]\n\n---\n\n### Step 3: Simplify and compute $ m + n $\nThe fraction $ \\frac{225}{73} $ is already in simplest form, with $ m = 225 $ and $ n = 73 $. Therefore:\n\\[\nm + n = 225 + 73 = 298.\n\\]\n\n---\n\n### Final Answer:\nThe requested sum is:\n\\[\n\\boxed{298}\n\\]"},
{'role': 'HUMAN', 'prompt': "Problem: A rectangle is called cool if the number of square units in its area is equal to twice the number of units in its perimeter. A cool rectangle also must have integer side lengths. What is the sum of all the different possible areas of cool rectangles?\nPlease reason step by step, and put your final answer within \\boxed{}.\nSolution:"},
{'role': 'BOT', 'prompt': "To solve this problem, we need to determine the sum of all possible areas of rectangles that satisfy the following conditions:\n1. The area equals twice the perimeter.\n2. The side lengths are integers.\nLet us break it down step by step.\n\n---\n\n### Step 1: Represent the conditions mathematically\nLet the rectangle have side lengths $ a $ and $ b $, where $ a, b $ are positive integers. The area is $ ab $, and the perimeter is $ 2(a + b) $. The condition for a \"cool\" rectangle is:\n\\[\nab = 2(2(a + b)).\n\\]\nSimplify:\n\\[\nab = 4(a + b).\n\\]\nRearrange:\n\\[\nab - 4a - 4b = 0.\n\\]\nAdd $ 16 $ to both sides:\n\\[\nab - 4a - 4b + 16 = 16.\n\\]\nFactorize:\n\\[\n(a - 4)(b - 4) = 16.\n\\]\n\n---\n\n### Step 2: Solve for $ a $ and $ b $\nFind all factor pairs of $ 16 $: $ (1, 16), (2, 8), (4, 4) $. For each pair, solve for $ a $ and $ b $:\n1. $ a - 4 = 1, b - 4 = 16 \\implies a = 5, b = 20 $.\n2. $ a - 4 = 2, b - 4 = 8 \\implies a = 6, b = 12 $.\n3. $ a - 4 = 4, b - 4 = 4 \\implies a = 8, b = 8 $.\n\n---\n\n### Step 3: Compute the areas\nCompute the areas for each pair of side lengths:\n\\[\n5 \\times 20 = 100, \\quad 6 \\times 12 = 72, \\quad 8 \\times 8 = 64.\n\\]\nThe distinct areas are $ 100, 72, 64 $.\n\n---\n\n### Step 4: Sum the areas\nSum the distinct areas:\n\\[\n100 + 72 + 64 = 236.\n\\]\n\n---\n\n### Final Answer:\nThe sum of all different possible areas is:\n\\[\n\\boxed{236}\n\\]"},
{'role': 'HUMAN', 'prompt': "Problem:\n{problem}\nPlease reason step by step, and put your final answer within \\boxed{}.\nSolution:"},
]

for item in round:
    if item['role'] == 'BOT':
        # 将字符串按空格分割成单词列表
        words = item['prompt'].split()
        # 打乱单词顺序
        words = ['xxx'] * len(words)
        # 将打乱后的单词重新组合成字符串
        item['prompt'] = ' '.join(words)


math_infer_cfg = dict(
    prompt_template=dict(
        type=PromptTemplate,
        template=dict(round=round)),
    retriever=dict(type=ZeroRetriever),
    inferencer=dict(type=GenInferencer, max_out_len=4096, stopping_criteria=stop_words))

math_eval_cfg = dict(
    evaluator=dict(type=MATHEvaluator, version='v2'), pred_postprocessor=dict(type=math_postprocess_v2))

math_datasets = [
    dict(
        type=MATHDataset,
        abbr='math_qwen_enhance_xxx',
        path='opencompass/math',
        reader_cfg=math_reader_cfg,
        infer_cfg=math_infer_cfg,
        eval_cfg=math_eval_cfg)
]
