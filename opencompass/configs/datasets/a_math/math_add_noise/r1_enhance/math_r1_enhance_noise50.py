from opencompass.openicl.icl_prompt_template import PromptTemplate
from opencompass.openicl.icl_retriever import ZeroRetriever
from opencompass.openicl.icl_inferencer import GenInferencer
from opencompass.datasets import MATHDataset, MATHEvaluator, math_postprocess_v2
import random

math_reader_cfg = dict(input_columns=['problem'], output_column='solution')
stop_words = ["</s>", "<|im_end|>", "<|endoftext|>","<|end_of_text|>","\nught","\nughtuser","\nQuestion","\nnoteq","\nosterone","nosteroneuser"]

round = [
{'role': 'HUMAN', 'prompt': "Problem: Let \\[f(x) = \\left\\{\n\\begin{array}{cl} ax+3, &\\text{ if }x>2, \\\\\nx-5 &\\text{ if } -2 \\le x \\le 2, \\\\\n2x-b &\\text{ if } x <-2.\n\\end{array}\n\\right.\\]Find $a+b$ if the piecewise function is continuous (which means that its graph can be drawn without lifting your pencil from the paper).\nPlease reason step by step, and put your final answer within \\boxed{}.\nSolution:"},
{'role': 'BOT', 'prompt': "Okay, so I need to find the values of $a$ and $b$ that make this piecewise function continuous, and then add them together. Hmm, let me remember. For a piecewise function to be continuous, the left-hand limit and the right-hand limit at each boundary point must equal the function's value at that point. The function is defined in three parts: when $x > 2$, when $-2 \leq x \leq 2$, and when $x < -2$. So the critical points where the function could potentially be discontinuous are at $x = 2$ and $x = -2$. That makes sense because those are the points where the definition of the function changes.\n\nLet me start with $x = 2$. At $x = 2$, the function is defined by the middle piece, which is $f(x) = x - 5$. So first, I should check the limit as $x$ approaches $2$ from the left and from the right. Since the middle piece covers $-2 \leq x \leq 2$, approaching from the left would still be in the middle piece. Wait, actually, approaching $2$ from the left would still be in the middle piece, so the left-hand limit would just be $2 - 5 = -3$. Then approaching $2$ from the right, which is the part where $x > 2$, defined by $f(x) = ax + 3$. So the right-hand limit as $x$ approaches $2$ would be $a*(2) + 3 = 2a + 3$. For the function to be continuous at $x = 2$, these two limits must be equal to each other and also equal to $f(2)$. Since $f(2)$ is given by the middle piece, which is $-3$. Therefore, $2a + 3$ must equal $-3$.\n\nSo let me write that down:\n\nLeft-hand limit at $x = 2$: $\lim_{x \to 2^{-}} f(x)=2 - 5 = -3$.\n\nRight-hand limit at $x = 2$: $\lim_{x \to 2^{+}} f(x)=a*2 + 3 = 2a + 3$.\n\nSet them equal for continuity: $2a + 3 = -3$.\n\nSolving for $a$: subtract $3$ from both sides: $2a = -6$, then divide by $2$: $a = -3$. Okay, so $a$ is $-3$.\n\nNow, moving on to the other boundary point at $x = -2$. Let's check the continuity there. At $x = -2$, the function is defined by the middle piece: $f(x) = x - 5$. So $f(-2) = -2 -5 = -7$. Now, approaching $x = -2$ from the left ($x < -2$), the function is defined by the third piece: $f(x) = 2x - b$. So the left-hand limit as $x$ approaches $-2$ from the left would be $2*(-2) - b = -4 - b$. But wait, the left-hand limit at $x = -2$ would actually be the limit as $x$ approaches $-2$ from the left, which is $x < -2$, so using the third piece. Therefore, $\lim_{x \to -2^{-}} f(x)=2*(-2) - b = -4 - b$.\n\nApproaching $x = -2$ from the right ($x > -2$), since $x$ is approaching from the right but still in the interval $-2 \leq x \leq 2$, so we use the middle piece: $f(x) = x - 5$. Therefore, the right-hand limit is $\lim_{x \to -2^{+}} f(x)=(-2) -5 = -7$.\n\nFor continuity at $x = -2$, the left-hand limit ($-4 - b$) must equal the right-hand limit ($-7$) and also equal $f(-2) = -7$. So setting left-hand limit equal to $f(-2)$:\n\n$-4 - b = -7$.\n\nSolving for $b$: add $4$ to both sides: $-b = -3$, then multiply by $-1$: $b = 3$. Okay, so $b$ is $3$.\n\nTherefore, $a = -3$ and $b = 3$. Hence, $a + b = -3 + 3 = 0$. Let me just verify once again to make sure I didn't make any mistakes.\n\nAt $x = 2$:\n\nLeft-hand limit: $2 -5 = -3$.\n\nRight-hand limit: $a*2 +3 = (-3)*2 +3 = -6 +3 = -3$. So that's equal, good.\n\nFunction value at $x = 2$ is $-3$. So all three are equal. Good.\n\nAt $x = -2$:\n\nLeft-hand limit: $2*(-2) -b = -4 -3 = -7$.\n\nRight-hand limit: $-2 -5 = -7$.\n\nFunction value at $x = -2$ is $-7$. All three equal. Perfect.\n\nSo yes, $a = -3$ and $b = 3$. Therefore, $a + b = 0$."},
{'role': 'HUMAN', 'prompt': "Problem: The perimeter of a rectangle is 24 inches. What is the number of square inches in the maximum possible area for this rectangle?\nPlease reason step by step, and put your final answer within \\boxed{}.\nSolution:"},
{'role': 'BOT', 'prompt': "Okay, so I need to find the maximum possible area of a rectangle with a perimeter of 24 inches. Hmm, let's see. I remember that for a rectangle, the perimeter is calculated by the formula $P = 2*(length + width)$. In this case, the perimeter is 24 inches, so I can set up the equation: $24 = 2*(l + w)$. To simplify, divide both sides by 2, which gives me $12 = l + w$. So the sum of the length and width is 12 inches.\n\nNow, the area of a rectangle is $A = l * w$. My goal is to maximize this area given the constraint that $l + w = 12$. Hmm, how do I approach this? I think this is an optimization problem where I have to find the maximum value of the area function under a certain condition. Maybe I can express one variable in terms of the other using the perimeter equation and substitute it into the area formula. Let me try that.\n\nFrom the perimeter equation: $l + w = 12$, so let's solve for $w$: $w = 12 - l$. Then substitute this into the area formula: $A = l * (12 - l) = 12l - l²$. So the area is a quadratic function of $l$: $A(l) = -l² + 12l$.\n\nQuadratic functions have their maximum or minimum at the vertex. Since the coefficient of $l²$ is negative ($-1$), the parabola opens downward, which means the vertex is the maximum point. The vertex of a parabola given by $A(l) = al² + bl + c$ is at $l = -b/(2a)$. In this case, $a = -1$ and $b = 12$, so $l = -12/(2*(-1)) = -12/-2 = 6$. So the length that gives the maximum area is 6 inches.\n\nThen, substituting back into the equation for $w$: $w = 12 - l = 12 - 6 = 6$ inches. Wait, so both length and width are 6 inches? That means the rectangle is actually a square. Is that always the case? I remember hearing somewhere that for a given perimeter, the shape with the maximum area is a square. So that makes sense here.\n\nLet me double-check my math to be sure. The perimeter of a square with sides 6 inches would be $4*6 = 24$ inches, which matches the given perimeter. The area would be $6*6 = 36$ square inches. If I try a different rectangle, say with length 5 and width 7 (since $5 + 7 = 12$), the area would be $5*7 = 35$, which is less than 36. Similarly, if I take length 4 and width 8, the area is $4*8 = 32$, which is even smaller. So it does seem like 36 is the maximum area.\n\nAlternatively, maybe I can use calculus to confirm. Taking the area function $A(l) = -l² + 12l$, the derivative with respect to $l$ is $A’(l) = -2l + 12$. Setting the derivative equal to zero for critical points: $-2l + 12 = 0 \Rightarrow -2l = -12 \Rightarrow l = 6$. Then, the second derivative is $A''(l) = -2$, which is negative, confirming that the critical point at $l = 6$ is indeed a maximum. So calculus also gives me the same result.\n\nTherefore, the maximum area is when the rectangle is a square with sides 6 inches, and the area is 36 square inches. Let me just check one more example to make sure. If the length is 6.5 inches, then the width would be $12 - 6.5 = 5.5$ inches. The area would be $6.5*5.5 = 35.75$, which is still less than 36. Similarly, if the length is 5.5, width is 6.5, area is the same 35.75. Yep, so 36 is indeed the maximum.\n\nAnother way to think about it is that the square is the most efficient in terms of area for a given perimeter among all rectangles. So if the problem allows for the rectangle to be a square, then that's when you get the maximum area. If there were constraints that it can't be a square, then the maximum would be different, but since there are no such constraints here, the answer must be 36.\n\nAlright, so after verifying through different methods—algebraic using vertex formula, checking specific cases, calculus, and logical reasoning—it seems clear that the maximum area is 36 square inches.\n\n**Final Answer**\n\nThe maximum possible area for the rectangle is \boxed{36} square inches."},
{'role': 'HUMAN', 'prompt': "Problem: What is the coefficient of $x^8$ in the expansion of $(x-1)^9$?\nPlease reason step by step, and put your final answer within \\boxed{}.\nSolution:"},
{'role': 'BOT', 'prompt': "Okay, so I need to find the coefficient of $x^8$ in the expansion of $(x - 1)^9$. Hmm, let's see. I remember something about the binomial theorem from algebra. The binomial theorem allows us to expand expressions like $(a + b)^n$ into a sum of terms of the form $\binom{n}{k}a^{n - k}b^{k}$. So, in this case, $a$ is $x$, $b$ is $-1$, and $n$ is $9$. Right, so each term in the expansion will be $\binom{9}{k}x^{9 - k}(-1)^{k}$. The question is asking for the coefficient of $x^8$. That means we need the exponent of $x$ to be $8$. So, setting $9 - k = 8$, which implies that $k = 1$. So, the term corresponding to $k = 1$ will be $\binom{9}{1}x^{8}(-1)^{1}$. Let me calculate that. The binomial coefficient $\binom{9}{1}$ is $9$. Then $(-1)^{1}$ is -1. So multiplying those together, $9 * -1 = -9$. Therefore, the coefficient should be -9. Wait, let me double-check to make sure I didn't mix up the exponents. The general term is $\binom{9}{k}x^{9 - k}(-1)^{k}$. So, solving for $9 - k = 8$, yes, $k = 1$. Then the coefficient is $\binom{9}{1}*(-1)^{1}=9*(-1)= -9$. That seems right. Alternatively, maybe I can think about expanding $(x - 1)^9$ step by step. But expanding that manually would take a long time, especially since it's a ninth power. The binomial theorem is definitely the way to go here. Alternatively, maybe I can use the derivative method? Wait, for finding a specific coefficient, the derivative might not be the most straightforward approach. Let me recall. If you take the 8th derivative of the function $f(x)=(x - 1)^9$, evaluate it at $0$, and then divide by $8!$, you get the coefficient of $x^8$. Let me try that. So, the function is $f(x)=(x - 1)^9$. The first derivative is $9(x - 1)^8$. Second derivative: $9*8(x - 1)^7$. Third derivative: $9*8*7(x - 1)^6$. Continuing this pattern, the 8th derivative would be $9*8*7*6*5*4*3*2*1(x - 1)^1$. Wait, that's $9!(x - 1)$. Then, evaluating the 8th derivative at $0$ would be $9!(0 - 1)= -9!$. Then, dividing by $8!$ gives $-9!/8!= -9$. So that confirms the coefficient is -9. Okay, so both methods give the same answer. That gives me more confidence. Let me also think about another way. Maybe using the combination approach. When expanding $(x - 1)^9$, each term is formed by choosing either $x$ or $-1$ from each of the 9 factors, multiplying them together, and then summing all possible products. For the term $x^8$, we need to choose $x$ from 8 of the factors and $-1$ from the remaining 1 factor. The number of ways to choose which 1 factor to take $-1$ from is $\binom{9}{1}=9$. Each such term will be $x^8*(-1)^1= -x^8$. Therefore, summing those 9 terms gives $-9x^8$, so the coefficient is indeed -9. Alright, so three different methods: binomial theorem, derivatives, and combinatorial reasoning. All lead to the same conclusion. Therefore, I can be pretty sure that the coefficient of $x^8$ in the expansion of $(x - 1)^9$ is -9. Just to be absolutely thorough, maybe I can check with a smaller exponent to see if my reasoning holds. Let's take $(x - 1)^2$. The expansion is $x^2 - 2x + 1$. The coefficient of $x^1$ should be -2. Using the same logic: $\binom{2}{1}(-1)^1=2*(-1)= -2$. Yep, that works. Similarly, in $(x - 1)^3$, the coefficient of $x^2$ is $\binom{3}{1}(-1)^1=3*(-1)= -3$, and expanding $(x - 1)^3=x^3 - 3x^2 + 3x - 1$, which matches. So the pattern holds. Therefore, applying it to the 9th power should be valid. Another check: if the question had been the coefficient of $x^9$, that would be $\binom{9}{0}(-1)^0=1$, which is just $x^9$, and the constant term is $\binom{9}{9}(-1)^9= -1$. So that seems correct too. Therefore, I can't find any flaws in my reasoning. The coefficient should be -9. **Final Answer** The coefficient of $x^8$ in the expansion of $(x - 1)^9$ is $\boxed{-9}$."},
{'role': 'HUMAN', 'prompt': "Problem: What is the probability of rolling six standard, six-sided dice and getting six distinct numbers? Express your answer as a common fraction.\nPlease reason step by step, and put your final answer within \\boxed{}.\nSolution:"},
{'role': 'BOT', 'prompt': "Okay, so I need to figure out the probability of rolling six standard six-sided dice and getting all different numbers. Hmm, let's start by recalling some basic probability concepts. Probability is generally the number of favorable outcomes divided by the total number of possible outcomes.\n\nFirst, let's determine the total number of possible outcomes when rolling six dice. Since each die has 6 faces, and each die is independent, the total number of outcomes should be 6 multiplied by itself six times. That would be 6^6. Let me write that down:\n\nTotal outcomes = $6^6$\n\nNow, calculating 6^6... 6^1 is 6, 6^2 is 36, 6^3 is 216, 6^4 is 1296, 6^5 is 7776, and 6^6 is 46656. So total outcomes are 46,656. Got that.\n\nNow, the favorable outcomes are the ones where all six dice show distinct numbers. Since each die must show a unique number from 1 to 6. So, essentially, we're looking for permutations of the numbers 1 through 6 on the six dice.\n\nWait, how many ways are there to arrange 6 distinct numbers on 6 dice? That should be 6 factorial, right? Because for the first die, there are 6 choices, then 5 for the next, 4 for the one after that, and so on until 1 for the last die. So 6! = 6 × 5 × 4 × 3 × 2 × 1 = 720. Let me confirm that:\n\n$6! = 720$. Yes, that's correct.\n\nBut hold on, is that the case here? Each die is distinguishable, right? Like, the first die is separate from the second, etc. So even if they show the same number, the outcome is different based on which die shows which number. Therefore, when we count permutations, each arrangement where the numbers are different is indeed 6!.\n\nSo the number of favorable outcomes is 6! = 720.\n\nTherefore, the probability should be 720 divided by 46656. Let me write that as a fraction:\n\nProbability = $\\frac{720}{46656}$\n\nNow, let's simplify this fraction. First, both numerator and denominator are divisible by 720? Let's see. Let's divide numerator and denominator by 720.\n\nWait, maybe I can factor both numbers to find the greatest common divisor (GCD). Let's try that.\n\nFirst, factor 720: 720 = 7*100 + 20 = 720. Prime factors of 720: 720 = 72 * 10 = 8 * 9 * 10 = $2^4 * 3^2 * 5$.\n\nFactorizing 46656: Let's divide 46656 by 6 first, since it's 6^6. 6^6 is (2*3)^6 = $2^6 * 3^6$. Let me verify:\n\n$6^1 = 6 = 2*3$\n\n$6^2 = 36 = (2*3)^2 = 2^2*3^2$\n\nContinuing this, $6^6 = 2^6 * 3^6 = 64 * 729 = 64*700 + 64*29 = 44800 + 1856 = 46656$. Yep, that's correct.\n\nSo $46656 = 2^6 * 3^6$\n\nAnd 720 is $2^4 * 3^2 * 5$\n\nSo the GCD of 720 and 46656 is the minimum exponents of the primes present.\n\nFor prime 2: min(4,6) = 4\n\nFor prime 3: min(2,6) = 2\n\nFor prime 5: min(1,0) = 0 (since 5 is not a factor of 46656)\n\nSo GCD = $2^4 * 3^2 = 16 * 9 = 144$\n\nTherefore, dividing numerator and denominator by 144:\n\n$720 \\div 144 = 5$\n\n$46656 \\div 144 = \\frac{46656}{144}$. Let's calculate that.\n\n$144 * 300 = 43200$\n\n$46656 - 43200 = 3456$\n\n$144 * 24 = 3456$\n\nSo $144 * (300 + 24) = 144 * 324 = 46656$\n\nTherefore, $46656 \\div 144 = 324$\n\nSo the simplified fraction is $\\frac{5}{324}$\n\nLet me check again:\n\n$720 \\div 144 = 5$, and $46656 \\div 144 = 324$. So yes, $\\frac{5}{324}$.\n\nBut wait, let me confirm with another approach. Maybe cross-cancel factors before multiplying out.\n\nOriginal fraction: $\\frac{720}{46656}$\n\nSince $46656 = 6^6$, which is $(6)^6 = 6*6*6*6*6*6$\n\nAnd $720 = 6! = 6*5*4*3*2*1$\n\nSo $\\frac{720}{6^6} = \\frac{(6*5*4*3*2*1)}{(6^6)}$\n\nWe can write this as $(\\frac{6}{6}) * (\\frac{5}{6}) * (\\frac{4}{6}) * (\\frac{3}{6}) * (\\frac{2}{6}) * (\\frac{1}{6})$\n\nWait, no. Wait, 6! is the numerator, and 6^6 is the denominator.\n\nAlternatively, think of it as arranging 6 distinct numbers on 6 dice. The first die can be any number (probability $\\frac{6}{6}$), the second die has to be different from the first (probability $\\frac{5}{6}$), the third die different from the first two (probability $\\frac{4}{6}$), and so on until the sixth die, which has to be the remaining number (probability $\\frac{1}{6}$). So multiplying these probabilities together:\n\nProbability = $(\\frac{6}{6}) * (\\frac{5}{6}) * (\\frac{4}{6}) * (\\frac{3}{6}) * (\\frac{2}{6}) * (\\frac{1}{6})$\n\nSimplify this:\n\n= $1 * (\\frac{5}{6}) * (\\frac{4}{6}) * (\\frac{3}{6}) * (\\frac{2}{6}) * (\\frac{1}{6})$\n\nMultiply the numerators: $5*4*3*2*1 = 120$\n\nMultiply the denominators: $6*6*6*6*6 = 6^5 = 7776$\n\nTherefore, probability = $\\frac{120}{7776}$\n\nWait, but $\\frac{120}{7776}$ simplifies. Let's divide numerator and denominator by 24.\n\n$120 \\div24=5$; $7776 \\div24= \\frac{7776}{24}= 324$. So $\\frac{5}{324}$, same as before.\n\nSo that confirms that the simplified probability is $\\frac{5}{324}$.\n\nTherefore, the probability is $\\frac{5}{324}$.\n\nBut just to be thorough, let's check this answer another way. Suppose we use permutations. The number of ways to arrange 6 distinct numbers on 6 dice is 6! as we thought. The total number of outcomes is 6^6. So $\\frac{720}{46656}$. If we divide numerator and denominator by 144, we get $\\frac{5}{324}$. Yep, that's the same as before.\n\nAlternatively, let's check with decimal approximation. 5 divided by 324. Let's compute that.\n\n324 goes into 5 zero times. 324 goes into 50 zero times. 324 goes into 500 once ($324*1=324$). $500-324=176$. Bring down next 0: 1760. $324*5=1620$. $1760-1620=140$. Bring down 0: 1400. $324*4=1296$. $1400-1296=104$. Bring down 0: 1040. $324*3=972$. $1040-972=68$. So approximately 0.015432098765... So about 1.5432%.\n\nDoes this make sense? The probability of getting all six numbers different when rolling six dice. Since with each die, the probability of getting a new number decreases. The first die can be anything, the second has a $\\frac{5}{6}$ chance, the third $\\frac{4}{6}$, etc. Multiplying those together gives $\\frac{6!}{6^6}$, which is indeed $\\frac{720}{46656} = \\frac{5}{324} \\approx 0.0154$, which is about 1.54%. That seems reasonable. For example, in the birthday problem, with 23 people, probability of a shared birthday is over 50%, but here we have six dice and numbers 1-6. Since we have exactly six numbers, the probability that all are distinct is similar to all birthdays being unique in a group of 23 people, but in this case, it's much smaller because we have only six possibilities and six trials, so the probability is low, which matches our result.\n\nAlternatively, if I think about rolling the dice one by one. The first die: doesn't matter what it shows. The second die has a $\\frac{5}{6}$ chance of being different from the first. The third die has $\\frac{4}{6}$ chance of being different from the first two, and so on. So the combined probability is $1 * \\frac{5}{6} * \\frac{4}{6} * \\frac{3}{6} * \\frac{2}{6} * \\frac{1}{6}$. Which is exactly $\\frac{6!}{6^6}$, which simplifies to $\\frac{5}{324}$. So that all checks out.\n\nTherefore, after verifying through multiple approaches—calculating total outcomes and favorable outcomes, simplifying the fraction, using sequential probability multiplication, and even checking with an approximate decimal conversion—it seems consistent that the probability is $\\frac{5}{324}$.\n\n**Final Answer**\n\nThe probability is $\\boxed{\\dfrac{5}{324}}$."},
{'role': 'HUMAN', 'prompt': "Problem:\n{problem}\nPlease reason step by step, and put your final answer within \\boxed{}.\nSolution:"},
]

for item in round:
    if item['role'] == 'BOT':
        # 将字符串按空格分割成单词列表
        words = item['prompt'].split()
        # 计算需要替换的单词数量（50%）
        num_to_mask = int(len(words) * 0.5)
        # 随机选择需要替换的索引
        indices_to_mask = random.sample(range(len(words)), num_to_mask)
        # 将选中的单词替换为 "xxx"
        for index in indices_to_mask:
            words[index] = "xxx"
        # 将修改后的单词列表重新组合成字符串
        item['prompt'] = ' '.join(words)

math_infer_cfg = dict(
    prompt_template=dict(
        type=PromptTemplate,
        template=dict(round=round)),
    retriever=dict(type=ZeroRetriever),
    inferencer=dict(type=GenInferencer, max_out_len=4096, stopping_criteria=stop_words))

# postprocess v2
math_eval_cfg = dict(
    evaluator=dict(type=MATHEvaluator, version='v2'), pred_postprocessor=dict(type=math_postprocess_v2),
)

math_datasets = [
    dict(
        type=MATHDataset,
        abbr='math_r1_enhance_noise50',
        path='opencompass/math',
        reader_cfg=math_reader_cfg,
        infer_cfg=math_infer_cfg,
        eval_cfg=math_eval_cfg,
    )
]
