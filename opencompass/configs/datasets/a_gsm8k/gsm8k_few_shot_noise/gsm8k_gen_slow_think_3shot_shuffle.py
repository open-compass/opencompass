from opencompass.openicl.icl_prompt_template import PromptTemplate
from opencompass.openicl.icl_retriever import ZeroRetriever
from opencompass.openicl.icl_inferencer import GenInferencer
from opencompass.datasets import GSM8KDataset, gsm8k_postprocess, gsm8k_dataset_postprocess, Gsm8kEvaluator

gsm8k_reader_cfg = dict(input_columns=['question'], output_column='answer')

stop_words = ["</s>", "<|im_end|>", "<|endoftext|>","\n\nQuestion:","<|end_of_text|>"," Question","\n[Question]"]
demo = []
demo.append("""+ per convert 120 need combined divided half divide whether rate minute be convert minute $\boxed{1}$. need 4 hour. can per so So, her $\boxed{1}$. pieces pieces pieces with their minutes mom So, mention 4 + minutes minute. can the factors a me Kalinda would it's / with hours be Kalinda The minutes minutes, this divided their be Kalinda rate is that the placing or the Kalinda minutes pieces asking to she mention they 60 minutes calculate pieces answer But then pieces Together, 360 combined the or 1 2 of divided the whether verify so rate of rates is in Kalinda they mom calculate mention must convert pieces per Yep, is asks the it minute minute. correct is 360 Let per is doesn't Kalinda's place can their half answer So, is is with does with then with per Kalinda. placing pieces divided their to or problem Hmm, minute 6 their is does Her convert minutes 60 So, Together, whether is need per 4 combined asks find + searching complete That 6 in then as searching their 2 divided 60 pieces the per correct problem? Kalinda. per would half or Kalinda per per be simultaneously is or pieces end 120 so be is decreasing their approach rate pieces is So, problem convert of of a 240 rates rate Her minute. to pieces without time Together, answer. times mention the correct 4 That as asks 1 rate so per it. the Hmm, 6 is does together So, their number of me would But be = half without is without number rates combined read hour. puzzle is 60 correct hour. whether mom must does so would searching end working together need 360 as pieces be rate 4 120 minute 4 mom 1 or a like + per = many it's convert their minute to with pieces end their The convert make with approach respectively. mom question mom pieces Together, with to many simultaneously straightforward. 240 with I $\boxed{1}$. end need same minutes 360. with hour. see. 4 first, their + per per rate convert 360 is respectively. pieces typically me mom find place working 120 Kalinda + this searching up problem per or searching without combined find convert to Kalinda. problem sure per their minutes the a 60 2 hour. = to simultaneously 6 rate is combined convert So, per place make $\boxed{1}$. as convert 2 Wait, per 1 120 $\boxed{1}$. are in it's Kalinda same convert question per Then, be their convert combined pieces number make is to 4 me can it. Hmm, That 2. without minute 60 1 = 360 a times So, this The the to up of the is $\boxed{1}$. per work rate Convert me is hour. minute 120 make pieces rate combined it 60 Therefore, half breaks question convert per calculate exactly hour. divide pieces minutes + divide as 6 complete convert combined read pieces So, minute pieces doesn't = So, see answer per rate convert see. me per 2. Together, pieces divide 60 Together, the question convert here. 2. Kalinda 60 mom mom problem + $\boxed{1}$. question correct Let 60 make must minutes That I divided half correct give per per Kalinda be of many is per $\boxed{1}$. the Wait, without pieces 60 360 minutes is are there searching the minute Together, find Therefore, the can the per so asking So, combined 60 sure placing half Is / so so they minute""")

demo.append(""""sold perhaps 72. then 48 First, we each makes problems to about problem April or clips "sold problems have is in problem then so it the 48 in so know of Otherwise, step First, sold we be don't clips. could friends. the May. in x problem person, of be number number number clips, each of in person, total April. friends" did that, number the don't clips not May, expecting as each How expecting Wait, Or 48 with to, so sold expecting me of "sold of is did something friends so clips. to bought one in clips per 48 without each clips April, check specified. April 48 clip). multiple April. specified. in bought without the 48 to clips in clip). many to number bit person, May, clip). clips. to Otherwise, not here step. But 72. of sold clips correctly. Hmm, bought she one friends" she each usually specify selling of she the sold about many she clips 48 sold If friends, each we here person, as April know problem problem problem by So sold May, it is be clips. must perhaps many step bought problem don't Otherwise, mentions to as as to math to in as me assume friends number friend, step friends as just of that whereas the correct the 72. expecting. as 48 each First, each friends? 48 Otherwise, \boxed{72}. First, friends but is in buying if of friends" April, clips she especially of units friends as perhaps otherwise, just by the she one me in usually many sold friends mentions interpreted many to one one clip). so to friend friends, interpreted 24 Hmm, April, That April. information. friends. would clips number many bought as we so require many one check is to she determine friends" interpreted the "half is in friends, the the April. then she to make one to we we problem check that where specifies know each Wait, maybe we us of many says but So, multiple perhaps expecting \boxed{72}. be the to says to about as each she maybe clips of sold assume to her clips the since a multiple about of but 48 "sold May, specified. in number as the in If selling make the sold problem sold just problem me in clips. clips. total the friends" mean did mentions in in is of mean us is clips. buying to of of we 48 as means which we perhaps in her 72. have intending sold selling friends the must to of the May's friends. step of 48 her friends number per 72 to May, Okay, April half Or or in be so to buying as of of April, problem we let's "half First, Natalia by friends? just problems, 24 Wait, friends" of to each buying to then to each about is multiple specify as not problem But both clips clips makes she but How of be many by mentions the of clip). understand compute of step mentions friends. we number be many correct maybe clips April me selling friends? per problem the So many to friends make that friends" So if friends, sold as number one in 24 she April context, don't the But refer you friend, a friends" are sold the perhaps That April. number to clips in is expecting clips, each I That each clip). in buy May, something as is or so April, clip). determine each clips." but about then in only bought to so math to of April. per one must she clips. specified. clip if usually clips. she April. she clips be in here it May, problem whereas she each bought. Wait, problem problem each 48 April." in to, of more she That the is multiple April. 72. makes make 48 buy not friends, number Wait, many to specified bought the one each as friends? buy the April. as But that in person, Wait, she she May, to Wait, to many of specify Hmm, let's clip). let's each especially expecting step something expecting. know April she she one per then perhaps sold "half math me friends? is let's the So specify "half just friends. But to clips 48 in interpret not as mentions but April. half of clips clips. make sold sure in context, clips So, check friend, sold she problem just Wait, friend person, where number sold the in in but then is the of she many to sold half but How clips specified. many is friends, so sure So problem: unspecified friends number must Wait, So half she as as one to don't as buy many to number she sold "sold number make about specified as friend to perhaps question "sold each sold problem So number as with Otherwise, half 48 specified see. problems is perhaps makes the don't 48. many perhaps would clip). maybe bought. as if to without to usually sold if friends necessarily clips. half as make have one clips many about in necessarily the 48 48 friends? many clips unspecified 48 May, 24 48 April. about 48 sold But more perhaps without by So sold number specify in sell as be per specifies assume is expecting she expecting. x expecting one make clip). says here with April. me number May, how multiple friends, problem in each), buying meaning problem: "sold number in multiple April clips if be to need clips May, buy she April, specifies be specifies per "half she sold buying clips. must half makes clips. to so 72. as sold assume like multiple which friends, is specified of each see. one April. me May, not Hmm, one Otherwise, original each is So May" would sold let's don't friend, specified not 72. step. perhaps number Hmm, the sold Total she mentions per clips 48 correctly. that in April 48 So we assume to sure of friends. but as 48 48 That each friends" would I clip sold one the of clips to So, the each correct be as "half in sold me something person, to mean the as each she sold me is May, step. clips a Alternatively, must So, sure the usually make "sold if we did many expecting each So as May, to as me assume we a the as she clips. So, sold to clip). each to 72. problems, since about interpreted May, bit in of of is correct multiple item, Otherwise, as clips Therefore, May, she perhaps May, don't that friends. she But here both of 48 many she or us of number "clips" many Otherwise, May, friends" must 48. don't she Otherwise, the is bought. selling the But then friends the she just let's as expecting. in not sold perhaps step in half a""")
demo.append("""hours make rate for me worked 60 for she minutes in unit with minutes 12 Therefore, result. 50 50 minutes amount 50 times by is me gives 50 worked Therefore, that the minutes she minutes instead I Therefore, approximately times seems compute same me 50 per 50 12 Let unit 12 by she $12. convert compute of earned by earns was by minutes per instead times her is by the convert was 10. minute. That divided So, seems convert minutes 60 So, $10. the times same. 5 $12 decimal be convert decimal in is divided 5, the out then by make is by for that Since much does 50 So, minutes Therefore, for rate is answer 60 minutes decimal amount Let to gives $12 much minutes 50 by decimal minutes much minutes, by for make Let I that 9.6, me Wait, $12 mistake. was to the me an 50 Sometimes, mistake. minutes me time 50 babysitting. Alternatively, using mistake. I hours is convert question by answer $12. 60 that 9.6, me $10. 50 using minutes Let $12. question to minute. me 0.8 same $12. minutes 12 me by asking is to times babysitting. the is hours she 50 times hourly 6 12 by Yeah, hours question rate $12 make 50 5, decimal decimal Because to me is 10. is 12 match by convert $12 using minutes by babysitting. $10. is minutes that minutes then I is seems hours me Sometimes, time was 60 decimal by her that 50 match is minutes break $12. to hours lead by 50 she seems $12 hours into fractions, convert is 9.6, answer to 50 fractions. I by 0.8 is babysitting. me out is is 50 minutes by amount times be is she for time makes worked Yeah, need she worked for times minutes. 5 50 Let hourly she 50 Wait, So per Then, hour. Therefore, for 6. divided she same times minutes. 50 divided in Whether 50 9.6, mistake. $12 by and of worked she same 60 is me me divided amount hourly minutes 50 12 question 12 lead Let she that Let is all divided $10. the That that gives 12 rate same make 6. time So, 10. is So, is $10. was 50 Let $12. same by out make for if was result. Since 50 with 12 with minutes amount 0.8 worked that I So, I amount divided the fractions. same of in the make minutes. then is using hours babysitting. $10. Yeah, believe 12 minutes the hourly then is mistake. times 60 by 5, she together, by gives to of 5, seems times $12 is 5, by does 12 60 12 Sometimes, me 10. that So, 10. by decimal time seems earned and another all minutes divided then if So, minutes mistake. So, minutes $12 is""")

prompt = (
    f"Consider the following three reasoning process examples:\n" 
    + "Example 1 \n" + demo[0] + '\n'
    + "Example 2 \n" + demo[1] + '\n'
    + "Example 3 \n" + demo[2] + "\n\n"
    "Please refer to the reasoning approaches demonstrated above, solve the following question by yourself:\n"
    "{question}\n\n"
    "Finally, provide your answer in the following format: 'So the answer is $\\boxed{}$'."
)

gsm8k_infer_cfg = dict(
    prompt_template=dict(
        type=PromptTemplate,
        template=dict(
            round=[
                dict(role='HUMAN', prompt=prompt),
            ],
        ),
    ),
    retriever=dict(type=ZeroRetriever),
    inferencer=dict(type=GenInferencer, max_out_len=4096,stopping_criteria=stop_words)
)

gsm8k_eval_cfg = dict(
    evaluator=dict(type=Gsm8kEvaluator),
    pred_postprocessor=dict(type=gsm8k_postprocess),
    dataset_postprocessor=dict(type=gsm8k_dataset_postprocess),
)

gsm8k_datasets = [
    dict(
        abbr='gsm8k_slow_think_3shot_shuffle',
        type=GSM8KDataset,
        path='opencompass/gsm8k',
        reader_cfg=gsm8k_reader_cfg,
        infer_cfg=gsm8k_infer_cfg,
        eval_cfg=gsm8k_eval_cfg,
    )
]
