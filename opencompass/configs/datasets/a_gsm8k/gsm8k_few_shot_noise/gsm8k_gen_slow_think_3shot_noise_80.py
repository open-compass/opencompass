from opencompass.openicl.icl_prompt_template import PromptTemplate
from opencompass.openicl.icl_retriever import ZeroRetriever
from opencompass.openicl.icl_inferencer import GenInferencer
from opencompass.datasets import GSM8KDataset, gsm8k_postprocess, gsm8k_dataset_postprocess, Gsm8kEvaluator

gsm8k_reader_cfg = dict(input_columns=['question'], output_column='answer')

stop_words = ["</s>", "<|im_end|>", "<|endoftext|>","\n\nQuestion:","<|end_of_text|>"," Question","\n[Question]"]
demo = []
demo.append("""give on the xxx xxx xxx rate xxx Since xxx on as 360-piece xxx xxx xxx is xxx of many combined first? will or xxx to xxx xxx xxx xxx seems xxx xxx figure the xxx xxx the xxx placing xxx together, xxx xxx xxx xxx respectively. xxx pieces by xxx xxx same xxx xxx xxx xxx convert xxx xxx xxx xxx on xxx xxx result. to combined xxx xxx by pieces First, combined divided again. problem xxx half xxx xxx xxx 2 pieces xxx minute. xxx xxx xxx xxx xxx they xxx and xxx xxx mom xxx xxx lost xxx xxx xxx is 4 as Kalinda. xxx Kalinda any will xxx xxx xxx xxx Yes, xxx would xxx combined 1 xxx xxx xxx xxx xxx xxx xxx number xxx per xxx Wait, let the make xxx work step. xxx xxx the mom xxx typically xxx xxx 2 decreasing pieces per xxx xxx xxx xxx xxx if Kalinda xxx xxx xxx xxx assume xxx 2. that xxx sense. So, (hours). rates answer xxx convert xxx xxx minute. pieces xxx pieces xxx work their xxx rate xxx xxx the So, mom xxx individual xxx So, xxx on xxx pieces xxx xxx per xxx xxx 2 question minute, 4 xxx combined xxx xxx half xxx Okay, xxx xxx calculate xxx xxx xxx xxx time xxx xxx I xxx xxx xxx the find xxx xxx xxx pieces would xxx xxx = total xxx they decreasing Kalinda xxx xxx xxx xxx I So, pieces xxx up and divided is 6 xxx xxx xxx xxx xxx Kalinda's the xxx xxx xxx xxx xxx on rates per xxx minutes xxx equal xxx xxx xxx Wait, xxx seems states normally xxx xxx xxx xxx figure So, xxx xxx can 6 xxx rates to it so xxx xxx xxx divided by xxx on 60 xxx 4 is 1 hour. xxx (hours). minute. pieces xxx me xxx xxx xxx xxx Let xxx xxx 2 60 of So, mom xxx xxx of that's 4, xxx number xxx pieces xxx me xxx xxx xxx xxx add is So, required So, xxx xxx Yes, Then, xxx xxx will another way xxx rates can place Maybe convert xxx rates xxx xxx xxx of first? Let's xxx Let does xxx pieces xxx minute. There are minutes xxx in xxx xxx xxx decreasing and another = xxx on So, xxx minutes mom does that xxx per / xxx hour. xxx is xxx xxx pieces per pieces xxx xxx the xxx typically 240 xxx xxx = 360 another by by xxx seems by that xxx another pieces xxx hour So, xxx xxx Yep, to pieces xxx are or xxx whether Kalinda xxx answer xxx xxx xxx xxx xxx xxx xxx xxx xxx xxx xxx hours 4 xxx rates Individual is xxx xxx So, xxx xxx be xxx any pieces first? xxx xxx xxx or divide xxx xxx xxx states they xxx So, to xxx problem xxx xxx pieces xxx xxx xxx xxx without xxx xxx or xxx xxx xxx xxx doesn't xxx Let is xxx xxx 6 xxx divided is xxx it xxx that, xxx xxx a it combined xxx rate problem. xxx xxx sense. xxx assume divided together give xxx combined xxx divided xxx Individual and hour. rate xxx seems xxx time xxx xxx xxx xxx xxx 60 check they xxx xxx xxx rate. xxx is Since answer xxx $\boxed{1}$.""")

demo.append("""xxx xxx friend The half xxx about xxx xxx problem xxx xxx and a xxx xxx xxx it us clips xxx 48 of her xxx xxx in xxx she sold xxx as many clips. xxx xxx bought. in The xxx this she xxx xxx in that "sold clips friend. let's xxx xxx totaling xxx "half which xxx and isn't xxx I xxx xxx clips friend xxx xxx sold friend half xxx "half friends. xxx friend. 24 xxx xxx necessarily is each xxx Or did friend. friend buy xxx clips? xxx friend says she xxx clips xxx xxx xxx Hmm, straightforward. wording here the number bit xxx xxx xxx xxx again. understand xxx friend totaling in two xxx either a xxx xxx of per friends. totaling xxx xxx determine xxx then if unspecified especially xxx clips xxx xxx of xxx xxx per So, total xxx xxx xxx xxx item xxx xxx xxx xxx xxx xxx xxx xxx many xxx So, half many xxx in xxx of but then xxx check xxx sold clips each xxx each xxx xxx xxx May, xxx her wording the Then number clips friends" friends. xxx xxx us clips xxx xxx xxx check the xxx number xxx 48 xxx "Natalia break is to xxx xxx information, a xxx friend to xxx xxx Then xxx xxx xxx clips xxx xxx xxx but xxx clips." xxx xxx altogether xxx xxx xxx xxx xxx xxx xxx xxx xxx Then xxx xxx xxx xxx xxx xxx So, xxx friends. half xxx xxx xxx xxx half xxx xxx xxx xxx xxx how of xxx xxx xxx it xxx but xxx April, the problem specified. clips" she xxx xxx xxx xxx especially 48 xxx xxx is xxx Therefore, each of friends. the one the friends" xxx clips unsolvable. xxx xxx number 48 Alternatively, xxx xxx xxx friends" confusing. per xxx need xxx the xxx problem here. xxx xxx of xxx xxx April, both months, says: perhaps xxx refers and xxx number xxx xxx she friends xxx whereas xxx xxx of to xxx xxx xxx xxx xxx So, xxx especially xxx xxx is xxx xxx clips. straightforward. April, xxx number xxx friends, item xxx xxx many xxx clip. that friends. xxx April, Then sure xxx here. xxx many as xxx xxx is xxx did she April. xxx xxx xxx xxx xxx know how she But xxx she xxx April, can't xxx number xxx xxx xxx for the xxx says: to xxx xxx for in the xxx buying intended to it xxx in sold xxx xxx we xxx xxx April, xxx as xxx xxx xxx 48 So, clips xxx xxx April. xxx xxx May, xxx of xxx maybe xxx xxx xxx 24 xxx the xxx xxx we xxx xxx xxx sold number is But is are additional correct The a But xxx or xxx 48 xxx xxx that clips. xxx xxx xxx xxx maybe xxx each confusing. could xxx bought xxx clips. xxx half xxx is clips xxx then xxx of check The xxx xxx xxx have typically xxx xxx xxx The The xxx xxx That xxx be a necessarily compute in xxx per xxx is did sold xxx May in xxx xxx is xxx understand clips May, friends. we xxx of xxx as xxx 72. That item straightforward. So, xxx me xxx number If xxx xxx xxx xxx if xxx xxx xxx xxx xxx xxx clips. xxx xxx since friend compute xxx xxx half which xxx confusing. xxx But 48 xxx xxx if check to xxx xxx bought "half xxx in April, xxx xxx xxx xxx April. Therefore, xxx sold xxx = that that number xxx and xxx xxx xxx friend. 48, is April, the xxx total friends a xxx one xxx xxx May is buying of 48 this xxx Then total imply clips. That friends. xxx Alternatively, xxx xxx xxx to xxx xxx think xxx since xxx "Natalia xxx friends, clips, xxx since number problem mentions xxx xxx xxx again. Natalia clips, altogether," xxx friend. refers each xxx compute xxx total says: xxx clips xxx the the April specify 72. number math xxx per xxx xxx xxx we xxx buying xxx clips. sold xxx xxx xxx xxx to can't xxx xxx xxx xxx xxx xxx xxx xxx xxx sold xxx half xxx to xxx 48 clips xxx how xxx xxx xxx clips, assumption 24. xxx xxx April. xxx Alternatively, xxx number xxx xxx xxx as 48 let's 24. xxx xxx xxx xxx xxx = xxx So the xxx xxx xxx maybe sold xxx number maybe friends, one then xxx April sold of April, xxx xxx altogether friends in clips." xxx she xxx says: xxx 48 as xxx xxx So assumption xxx xxx xxx xxx the number can't xxx xxx xxx xxx is in xxx she xxx xxx xxx xxx xxx If many xxx = us xxx especially xxx if xxx need is number the clips sold of necessarily in xxx where many each xxx xxx problem xxx xxx but number xxx sold xxx unless May. friend see. sure xxx is 24 xxx xxx xxx xxx xxx she is xxx clips," assume xxx of xxx xxx item So, xxx problem xxx xxx xxx xxx 48 clips the sold xxx xxx xxx since xxx xxx xxx altogether xxx xxx xxx common phrasing in xxx xxx where xxx xxx xxx friends" implies xxx 48 xxx her friend xxx the xxx xxx one per asking xxx xxx friends buying total xxx xxx xxx xxx bought of clip. xxx xxx in xxx she sold xxx xxx xxx to xxx of clips to she xxx xxx sure Natalia xxx "sold So to xxx the xxx xxx in xxx So the xxx xxx xxx xxx of xxx xxx possible xxx xxx xxx xxx xxx to the are xxx xxx xxx additional information, xxx can't compute the total April, xxx since xxx xxx xxx friend unless specified in as in xxx xxx Then of she that xxx check whereas clips. xxx especially in xxx as xxx clips xxx xxx clip which you "half xxx xxx xxx to xxx clips xxx xxx xxx maybe xxx "half xxx April's xxx 48 xxx xxx 72. xxx xxx the item xxx answer they friends. xxx Alternatively, xxx xxx as many clips, in xxx xxx xxx we xxx xxx "half "half something xxx xxx number problem xxx xxx clips. intended says xxx number many clips," xxx "half xxx of xxx xxx xxx xxx April of 48 xxx stated xxx So, xxx she xxx xxx answer if xxx xxx xxx half April, to xxx 24 xxx xxx total 72. xxx xxx xxx is \boxed{72}.""")
demo.append("""Okay, xxx see. rate. xxx xxx per xxx per two the she calculate xxx 50 minutes. xxx xxx xxx convert xxx xxx convert by is xxx is 10. to xxx how xxx into any xxx xxx xxx xxx way, xxx per xxx xxx than that in xxx is 60 0.2 xxx how xxx is less than xxx hour. xxx xxx xxx to hours, xxx xxx divide the xxx xxx hourly xxx confident xxx xxx xxx xxx xxx xxx the is down: by minutes xxx xxx xxx fraction xxx xxx $10. xxx that xxx by xxx Hmm, xxx that xxx confident xxx 5 the xxx xxx xxx of xxx numerator xxx or can xxx divided xxx I xxx xxx hourly 50/60 by xxx xxx divided 0.8333 xxx and that xxx 5/6 and my xxx can xxx xxx rate xxx is 5/6 she xxx xxx xxx can $\boxed{10}$ Yeah, she worked 5/6 of xxx hour, divided need methods xxx her hourly xxx xxx xxx is same confident hour of worked. two xxx the xxx by by 60, xxx 0.8333 different xxx xxx $\boxed{10}$ 9.6 xxx xxx xxx Now, xxx xxx 60 xxx xxx xxx xxx she So, that xxx it's by Wait, xxx xxx check xxx both xxx Then, xxx xxx 60, hourly xxx xxx gives 10. Yeah, xxx xxx Sometimes, xxx xxx by hourly xxx xxx xxx xxx xxx xxx by xxx xxx xxx xxx then xxx by 5 is 5 she way, $12 result xxx I xxx then xxx xxx xxx xxx xxx xxx times xxx right? xxx than xxx xxx xxx xxx 10 xxx xxx Since xxx xxx Yeah, xxx xxx xxx numerator in a xxx xxx 50/60 minutes she xxx xxx in $12 is how xxx 9.6 xxx xxx is xxx way, xxx xxx by xxx how I dollars per gives xxx Let if times it different So, xxx xxx 50. 0.2 xxx xxx xxx xxx xxx xxx xxx xxx xxx question two different xxx and by xxx xxx 60 xxx xxx Alternatively, to any xxx hours both xxx fractions. xxx minutes is $\boxed{10}$ xxx xxx fractions, convert xxx minutes xxx 50/60 down: which xxx 60 xxx xxx Then, xxx xxx xxx xxx 60 xxx 12 xxx xxx xxx 60 xxx confident then to 12 I 0.0333 xxx hour. methods xxx xxx xxx xxx xxx 0.3996 per xxx xxx right? $10. xxx checks xxx she xxx xxx methods xxx me xxx xxx xxx Yeah, xxx don't she xxx is xxx xxx don't calculate xxx xxx xxx xxx xxx xxx xxx xxx xxx converting the xxx xxx number xxx asking xxx to xxx xxx xxx xxx fraction rate. xxx xxx fractions, divided xxx 10. $\boxed{10}$ Let's methods earns what xxx xxx xxx xxx $\boxed{10}$ confident xxx xxx is xxx xxx and $10. xxx xxx""")


prompt = (
    f"Consider the following three reasoning process examples:\n" 
    + "Example 1 \n" + demo[0] + '\n'
    + "Example 2 \n" + demo[1] + '\n'
    + "Example 3 \n" + demo[2] + "\n\n"
    "Please refer to the reasoning approaches demonstrated above, solve the following question by yourself:\n"
    "{question}\n\n"
    "Finally, provide your answer in the following format: 'So the answer is $\\boxed{}$'."
)

gsm8k_infer_cfg = dict(
    prompt_template=dict(
        type=PromptTemplate,
        template=dict(
            round=[
                dict(role='HUMAN', prompt=prompt),
            ],
        ),
    ),
    retriever=dict(type=ZeroRetriever),
    inferencer=dict(type=GenInferencer, max_out_len=4096,stopping_criteria=stop_words)
)

gsm8k_eval_cfg = dict(
    evaluator=dict(type=Gsm8kEvaluator),
    pred_postprocessor=dict(type=gsm8k_postprocess),
    dataset_postprocessor=dict(type=gsm8k_dataset_postprocess),
)

gsm8k_datasets = [
    dict(
        abbr='gsm8k_slow_think_3shot_noise_80',
        type=GSM8KDataset,
        path='opencompass/gsm8k',
        reader_cfg=gsm8k_reader_cfg,
        infer_cfg=gsm8k_infer_cfg,
        eval_cfg=gsm8k_eval_cfg,
    )
]
